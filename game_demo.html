<!DOCTYPE html>
<html lang="ko">
<head>
Â  Â  <meta charset="UTF-8">
Â  Â  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
Â  Â  <title>YEAH! We Are CLOVERs!</title>
Â  Â  <style>
Â  Â  Â  Â  @font-face {
Â  Â  Â  Â  Â  Â  font-family: 'MyGameFont';
Â  Â  Â  Â  Â  Â  src: url('./fonts/Pak_Yong_jun.ttf') format('truetype');
Â  Â  Â  Â  }
Â  Â  Â  Â  html, body {
Â  Â  Â  Â  Â  Â  margin: 0;
Â  Â  Â  Â  Â  Â  padding: 0;
Â  Â  Â  Â  Â  Â  overflow: hidden;
Â  Â  Â  Â  Â  Â  background-color: #000;
Â  Â  Â  Â  Â  Â  width: 100%;
Â  Â  Â  Â  Â  Â  height: 100vh;
Â  Â  Â  Â  Â  Â  display: flex;
Â  Â  Â  Â  Â  Â  justify-content: center;
Â  Â  Â  Â  Â  Â  align-items: center;
Â  Â  Â  Â  }
Â  Â  Â  Â  canvas {
Â  Â  Â  Â  Â  Â  display: block;
Â  Â  Â  Â  Â  Â  cursor: pointer;
Â  Â  Â  Â  }
Â  Â  </style>
</head>
<body>
Â  Â  <canvas id="gameCanvas"></canvas>
Â  Â Â 
Â  Â  <audio id="bgm" src="./Love3.mp3" loop></audio>

Â  Â  <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-app-compat.js"></script>
Â  Â  <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-firestore-compat.js"></script>

Â  Â  <script>
Â  Â  Â  Â  // ==================================================================
Â  Â  Â  Â  // Firebase Config
Â  Â  Â  Â  // ==================================================================
Â  Â  Â  Â  const firebaseConfig = {
Â  Â  Â  Â  Â  Â  apiKey: "AIzaSyA90s1FUPCjbW3Wo_N8IVhMUqewmXhetq0",
Â  Â  Â  Â  Â  Â  authDomain: "clovergame-e712f.firebaseapp.com",
Â  Â  Â  Â  Â  Â  projectId: "clovergame-e712f",
Â  Â  Â  Â  Â  Â  storageBucket: "clovergame-e712f.appspot.com",
Â  Â  Â  Â  Â  Â  messagingSenderId: "525191060039",
Â  Â  Â  Â  Â  Â  appId: "1:525191060039:web:5707417e6e8ee8bf9cef62"
Â  Â  Â  Â  };
Â  Â  Â  Â  // ==================================================================

Â  Â  Â  Â  // --- ì „ì—­ ë³€ìˆ˜ ---
Â  Â  Â  Â  const canvas = document.getElementById('gameCanvas');
Â  Â  Â  Â  const ctx = canvas.getContext('2d');
Â  Â  Â  Â  const bgm = document.getElementById('bgm');
Â  Â  Â  Â Â 
Â  Â  Â  Â  const GAME_WIDTH = 540;
Â  Â  Â  Â  const GAME_HEIGHT = 960;
Â  Â  Â  Â Â 
Â  Â  Â  Â  const BGM_VOLUME_NORMAL = 0.5;
Â  Â  Â  Â  const BGM_VOLUME_MENU = BGM_VOLUME_NORMAL / 2;

Â  Â  Â  Â  let db, leaderboardCollection, cachedLeaderboard = null;
Â  Â  Â  Â Â 
Â  Â  Â  Â  // âœ¨ characters ë°°ì—´ì— ëˆ„ë½ëœ ì†ì„± ì¶”ê°€
Â  Â  Â  Â  const characters = [
Â  Â  Â  Â  Â  Â  { id: 1, name: 'PAIIEK', speed: 7, imgSrc: './char2.png', imgSrcSelected: './char2-1.png', imgIconSrc: './char2-2.png', imgHitSrc: './char2-3.png', selectSfxSrc: './sounds/char2-1.mp3', hitSfxSrc: './sounds/char2-1-1.mp3', selectVolume: 0.8, hitVolume: 1.0 },
Â  Â  Â  Â  Â  Â  { id: 2, name: 'KANG', speed: 8, imgSrc: './char3.png', imgSrcSelected: './char3-1.png', imgIconSrc: './char3-2.png', imgHitSrc: './char3-3.png', selectSfxSrc: './sounds/char3-1.mp3', hitSfxSrc: './sounds/char3-1-1.mp3', selectVolume: 1.0, hitVolume: 1.0 },
Â  Â  Â  Â  Â  Â  { id: 3, name: 'NAH', speed: 9, imgSrc: './char1.png', imgSrcSelected: './char1-1.png', imgIconSrc: './char1-2.png', imgHitSrc: './char1-3.png', selectSfxSrc: './sounds/char1-1.mp3', hitSfxSrc: './sounds/char1-1-1.mp3', selectVolume: 0.5, hitVolume: 1.0 }
Â  Â  Â  Â  ];
Â  Â  Â  Â  characters.forEach(char => {
Â  Â  Â  Â  Â  Â  char.img = null; char.imgSelected = null; char.imgIcon = null; char.imgHit = null;
Â  Â  Â  Â  });
Â  Â  Â  Â Â 
Â  Â  Â  Â  let selectedCharacterId = 1;
Â  Â  Â  Â Â 
Â  Â  Â  Â  let uiBoxes = {}, startScreenState = 'main';Â 
Â  Â  Â  Â  let leaderboardScrollY = 0, isDragging = false, lastTouchY = 0;
Â  Â  Â  Â  let player, objects, score, spawnTimer, targetX;
Â  Â  Â  Â  let gameState = 'loading';
Â  Â  Â  Â  let lastTime = 0, gameSpeedMultiplier = 1;
Â  Â  Â  Â  let feverScore = 0, isFeverTime = false, feverTimer = 0;
Â  Â  Â  Â  const FEVER_DURATION = 5000, FEVER_TRIGGER_COUNT = 10;
Â  Â  Â  Â  const BASE_SPAWN_INTERVAL = 450, FEVER_SPAWN_INTERVAL = 120;
Â  Â  Â  Â  let pauseButtonBox = {};
Â  Â  Â  Â  let animationFrameId;
Â  Â  Â  Â Â 
Â  Â  Â  Â  let lives;
Â  Â  Â  Â  const MAX_LIVES = 3;

Â  Â  Â  Â  let cloverImg = new Image(), loveImg = new Image(), bombImg = new Image(), cloverTitleImg = new Image();
Â  Â  Â  Â  let darkGrayBtnImg = new Image(), lightGrayBtnImg = new Image();
Â  Â  Â  Â  let majorImg = new Image(), yellowImg = new Image(), grayImg = new Image();
Â  Â  Â  Â  let hasInteracted = false;

Â  Â  Â  Â  const BOMB_HIT_SFX_SRC = './sounds/bomb_hit.mp3';
Â  Â  Â  Â  const BUTTON_CLICK_SFX_SRC = './sounds/button_click.mp3';
Â  Â  Â  Â  const GAME_OVER_SFX_SRC = './sounds/game_over.mp3';

Â  Â  Â  Â  // --- í•¨ìˆ˜ ì •ì˜ ---
Â  Â  Â  Â Â 
Â  Â  Â  Â  function initializeFirebase() { try { firebase.initializeApp(firebaseConfig); db = firebase.firestore(); leaderboardCollection = db.collection('leaderboard'); } catch (e) { console.error("Firebase ì´ˆê¸°í™” ì˜¤ë¥˜:", e); alert("Firebase ì—°ê²°ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤. firebaseConfigë¥¼ í™•ì¸í•´ì£¼ì„¸ìš”."); } }
Â  Â  Â  Â  function listenForLeaderboardUpdates() { if (!leaderboardCollection) return; leaderboardCollection.orderBy('score', 'desc').limit(10).onSnapshot(snapshot => { const leaderboard = []; snapshot.forEach(doc => { leaderboard.push(doc.data()); }); cachedLeaderboard = leaderboard; }, error => { console.error("ìˆœìœ„í‘œ ì‹¤ì‹œê°„ ë¡œë”© ì˜¤ë¥˜: ", error); cachedLeaderboard = []; }); }
Â  Â  Â  Â  async function saveToLeaderboard(newScore, nickname) { if (!leaderboardCollection) return; try { const character = characters.find(c => c.id === selectedCharacterId); const characterName = character ? character.name : 'Unknown'; await leaderboardCollection.add({ score: newScore, name: nickname, character: characterName }); } catch (error) { console.error("ìˆœìœ„í‘œ ì €ì¥ ì˜¤ë¥˜: ", error); } }
Â  Â  Â  Â Â 
Â  Â  Â  Â  function loadImages() {
Â  Â  Â  Â  Â  Â  let promises = characters.flatMap(char => [
Â  Â  Â  Â  Â  Â  Â  Â  new Promise((resolve, reject) => { char.img = new Image(); char.img.src = char.imgSrc; char.img.onload = () => { char.originalWidth = char.img.naturalWidth; char.originalHeight = char.img.naturalHeight; resolve(); }; char.img.onerror = () => reject(`ì´ë¯¸ì§€ ë¡œë“œ ì‹¤íŒ¨: ${char.imgSrc}`); }),
Â  Â  Â  Â  Â  Â  Â  Â  new Promise((resolve, reject) => { char.imgSelected = new Image(); char.imgSelected.src = char.imgSrcSelected; char.imgSelected.onload = resolve; char.imgSelected.onerror = () => reject(`ì´ë¯¸ì§€ ë¡œë“œ ì‹¤íŒ¨: ${char.imgSrcSelected}`); }),
Â  Â  Â  Â  Â  Â  Â  Â  new Promise((resolve, reject) => { char.imgIcon = new Image(); char.imgIcon.src = char.imgIconSrc; char.imgIcon.onload = resolve; char.imgIcon.onerror = () => reject(`ì´ë¯¸ì§€ ë¡œë“œ ì‹¤íŒ¨: ${char.imgIconSrc}`); }),
Â  Â  Â  Â  Â  Â  Â  Â  new Promise((resolve, reject) => { if (char.imgHitSrc) { char.imgHit = new Image(); char.imgHit.src = char.imgHitSrc; char.imgHit.onload = resolve; char.imgHit.onerror = () => reject(`ì´ë¯¸ì§€ ë¡œë“œ ì‹¤íŒ¨: ${char.imgHitSrc}`); } else { resolve(); } })
Â  Â  Â  Â  Â  Â  ]);
Â  Â  Â  Â  Â  Â  promises.push(new Promise((resolve, reject) => { cloverImg.src = './clover.png'; cloverImg.onload = resolve; cloverImg.onerror = () => reject('ì´ë¯¸ì§€ ë¡œë“œ ì‹¤íŒ¨: clover.png'); }));
Â  Â  Â  Â  Â  Â  promises.push(new Promise((resolve, reject) => { loveImg.src = './love.png'; loveImg.onload = resolve; loveImg.onerror = () => reject('ì´ë¯¸ì§€ ë¡œë“œ ì‹¤íŒ¨: love.png'); }));
Â  Â  Â  Â  Â  Â  promises.push(new Promise((resolve, reject) => { bombImg.src = './bomb.png'; bombImg.onload = resolve; bombImg.onerror = () => reject('ì´ë¯¸ì§€ ë¡œë“œ ì‹¤íŒ¨: bomb.png'); }));
Â  Â  Â  Â  Â  Â  promises.push(new Promise((resolve, reject) => { cloverTitleImg.src = './clover_title.png'; cloverTitleImg.onload = resolve; cloverTitleImg.onerror = () => reject('ì´ë¯¸ì§€ ë¡œë“œ ì‹¤íŒ¨: clover_title.png'); }));
Â  Â  Â  Â  Â  Â  promises.push(new Promise((resolve, reject) => { darkGrayBtnImg.src = './darkgray.png'; darkGrayBtnImg.onload = resolve; darkGrayBtnImg.onerror = () => reject('ì´ë¯¸ì§€ ë¡œë“œ ì‹¤íŒ¨: darkgray.png'); }));
Â  Â  Â  Â  Â  Â  promises.push(new Promise((resolve, reject) => { lightGrayBtnImg.src = './lightgray.png'; lightGrayBtnImg.onload = resolve; lightGrayBtnImg.onerror = () => reject('ì´ë¯¸ì§€ ë¡œë“œ ì‹¤íŒ¨: lightgray.png'); }));
Â  Â  Â  Â  Â  Â  promises.push(new Promise((resolve, reject) => { majorImg.src = './major.png'; majorImg.onload = resolve; majorImg.onerror = () => reject('ì´ë¯¸ì§€ ë¡œë“œ ì‹¤íŒ¨: major.png'); }));
Â  Â  Â  Â  Â  Â  promises.push(new Promise((resolve, reject) => { yellowImg.src = './yellow.png'; yellowImg.onload = resolve; yellowImg.onerror = () => reject('ì´ë¯¸ì§€ ë¡œë“œ ì‹¤íŒ¨: yellow.png'); }));
Â  Â  Â  Â  Â  Â  promises.push(new Promise((resolve, reject) => { grayImg.src = './gray.png'; grayImg.onload = resolve; grayImg.onerror = () => reject('ì´ë¯¸ì§€ ë¡œë“œ ì‹¤íŒ¨: gray.png'); }));
Â  Â  Â  Â  Â  Â  return Promise.all(promises);
Â  Â  Â  Â  }

Â  Â  Â  Â  function playSound(src, volume = 1.0) {
Â  Â  Â  Â  Â  Â  if (!src || !hasInteracted) return;
Â  Â  Â  Â  Â  Â  const audio = new Audio(src);
Â  Â  Â  Â  Â  Â  audio.volume = volume;
Â  Â  Â  Â  Â  Â  audio.play().catch(e => console.error(`ì˜¤ë””ì˜¤ ì¬ìƒ ì˜¤ë¥˜: ${src}`, e));
Â  Â  Â  Â  }

Â  Â  Â  Â  function init() {
Â  Â  Â  Â  Â  Â  const selectedCharacter = characters.find(c => c.id === selectedCharacterId);
Â  Â  Â  Â  Â  Â  const playerWidth = GAME_WIDTH * 0.2;
Â  Â  Â  Â  Â  Â  const aspectRatio = selectedCharacter.originalHeight / selectedCharacter.originalWidth;
Â  Â  Â  Â  Â  Â  const playerHeight = playerWidth * aspectRatio;
Â  Â  Â  Â  Â  Â  player = { width: playerWidth, height: playerHeight, x: GAME_WIDTH / 2 - playerWidth / 2, y: GAME_HEIGHT - playerHeight - (GAME_HEIGHT * 0.1), speed: selectedCharacter.speed, img: selectedCharacter.img, originalImg: selectedCharacter.img, hitImg: selectedCharacter.imgHit, hitTimer: 0, dx: 0 };
Â  Â  Â  Â  Â  Â  targetX = player.x; objects = []; score = 0; spawnTimer = 0;
Â  Â  Â  Â  Â  Â  gameSpeedMultiplier = 1; feverScore = 0; isFeverTime = false; feverTimer = 0;
Â  Â  Â  Â  Â  Â  lives = MAX_LIVES;
Â  Â  Â  Â  Â  Â  gameState = 'playing';
Â  Â  Â  Â  Â  Â  bgm.currentTime = 0;
Â  Â  Â  Â  Â  Â  bgm.volume = BGM_VOLUME_NORMAL;
Â  Â  Â  Â  Â  Â  bgm.play();
Â  Â  Â  Â  }
Â  Â  Â  Â Â 
Â  Â  Â  Â  function resizeCanvas() {
Â  Â  Â  Â  Â  Â  const viewportWidth = window.innerWidth; const viewportHeight = window.innerHeight;
Â  Â  Â  Â  Â  Â  const scale = Math.min(viewportWidth / GAME_WIDTH, viewportHeight / GAME_HEIGHT);
Â  Â  Â  Â  Â  Â  const newCssWidth = GAME_WIDTH * scale; const newCssHeight = GAME_HEIGHT * scale;
Â  Â  Â  Â  Â  Â  canvas.style.width = `${newCssWidth}px`; canvas.style.height = `${newCssHeight}px`;
Â  Â  Â  Â  Â  Â  const dpr = window.devicePixelRatio || 1;
Â  Â  Â  Â  Â  Â  canvas.width = GAME_WIDTH * dpr; canvas.height = GAME_HEIGHT * dpr;
Â  Â  Â  Â  Â  Â  ctx.scale(dpr, dpr);
Â  Â  Â  Â  Â  Â  drawCurrentState();
Â  Â  Â  Â  }

Â  Â  Â  Â  function drawCurrentState() {
Â  Â  Â  Â  Â  Â  const bgColor = (gameState === 'playing' && isFeverTime) ? '#e8f5e9' : '#f0f0f0';
Â  Â  Â  Â  Â  Â  canvas.style.backgroundColor = bgColor;
Â  Â  Â  Â  Â  Â  ctx.clearRect(0, 0, GAME_WIDTH, GAME_HEIGHT);
Â  Â  Â  Â  Â  Â  ctx.fillStyle = bgColor;
Â  Â  Â  Â  Â  Â  ctx.fillRect(0, 0, GAME_WIDTH, GAME_HEIGHT);
Â  Â  Â  Â  Â  Â  if (gameState === 'loading') { ctx.fillStyle = 'black'; ctx.font = '24px "MyGameFont"'; ctx.textAlign = 'center'; ctx.fillText('ë¡œë”© ì¤‘...', GAME_WIDTH / 2, GAME_HEIGHT / 2); }
Â  Â  Â  Â  Â  Â  else if (gameState === 'startScreen') { drawStartScreen(); }
Â  Â  Â  Â  Â  Â  else if (gameState === 'playing') { drawObjects(); drawPlayer(); drawUI(); }
Â  Â  Â  Â  Â  Â  else if (gameState === 'paused') { drawPauseScreen(); }
Â  Â  Â  Â  Â  Â  else if (gameState === 'gameOver') { drawGameOver(); }
Â  Â  Â  Â  }
Â  Â  Â  Â Â 
Â  Â  Â  Â  function getEventPos(e) {Â 
Â  Â  Â  Â  Â  Â  const rect = canvas.getBoundingClientRect();
Â  Â  Â  Â  Â  Â  const clientX = e.touches ? e.touches[0].clientX : e.clientX;
Â  Â  Â  Â  Â  Â  const clientY = e.touches ? e.touches[0].clientY : e.clientY;
Â  Â  Â  Â  Â  Â  const gameX = (clientX - rect.left) / rect.width * GAME_WIDTH;
Â  Â  Â  Â  Â  Â  const gameY = (clientY - rect.top) / rect.height * GAME_HEIGHT;
Â  Â  Â  Â  Â  Â  return { x: gameX, y: gameY };
Â  Â  Â  Â  }
Â  Â  Â  Â  function isInside(pos, rect) { return rect && pos.x > rect.x && pos.x < rect.x + rect.width && pos.y > rect.y && pos.y < rect.y + rect.height; }
Â  Â  Â  Â Â 
Â  Â  Â  Â  function drawPlayer() {
Â  Â  Â  Â  Â  Â  let currentImg = (player.hitTimer > 0) ? player.hitImg : player.originalImg;
Â  Â  Â  Â  Â  Â  if (currentImg) { ctx.drawImage(currentImg, player.x, player.y, player.width, player.height); }
Â  Â  Â  Â  }
Â  Â  Â  Â Â 
Â  Â  Â  Â  function drawObjects() {
Â  Â  Â  Â  Â  Â  objects.forEach(obj => {
Â  Â  Â  Â  Â  Â  Â  Â  let imgToDraw;
Â  Â  Â  Â  Â  Â  Â  Â  if (obj.type === 'good') imgToDraw = cloverImg;
Â  Â  Â  Â  Â  Â  Â  Â  else if (obj.type === 'special') imgToDraw = loveImg;
Â  Â  Â  Â  Â  Â  Â  Â  else if (obj.type === 'bad') imgToDraw = bombImg;
Â  Â  Â  Â  Â  Â  Â  Â  if (imgToDraw && imgToDraw.complete) { ctx.drawImage(imgToDraw, obj.x, obj.y, obj.width, obj.height); }
Â  Â  Â  Â  Â  Â  });
Â  Â  Â  Â  }
Â  Â  Â  Â Â 
Â  Â  Â  Â  function drawConfirmButton(yPos) { const btnWidth = 150, btnHeight = 50; const btnX = (GAME_WIDTH - btnWidth) / 2; uiBoxes.confirmBtn = { x: btnX, y: yPos, width: btnWidth, height: btnHeight }; if(darkGrayBtnImg.complete) ctx.drawImage(darkGrayBtnImg, btnX, yPos, btnWidth, btnHeight); ctx.fillStyle = 'white'; ctx.font = 'bold 20px "MyGameFont"'; ctx.textAlign = 'center'; ctx.fillText('í™•ì¸', GAME_WIDTH / 2, yPos + 32); }
Â  Â  Â  Â  function drawLeaderboardScreen() {
Â  Â  Â  Â  Â  Â  let listStartY = GAME_HEIGHT * 0.15;Â 
Â  Â  Â  Â  Â  Â  if (majorImg.complete && majorImg.naturalWidth > 0) {
Â  Â  Â  Â  Â  Â  Â  Â  const imgWidth = GAME_WIDTH * 0.6;
Â  Â  Â  Â  Â  Â  Â  Â  const imgHeight = (majorImg.naturalHeight / majorImg.naturalWidth) * imgWidth;
Â  Â  Â  Â  Â  Â  Â  Â  const imgY = GAME_HEIGHT * 0.05;
Â  Â  Â  Â  Â  Â  Â  Â  ctx.drawImage(majorImg, (GAME_WIDTH - imgWidth) / 2, imgY, imgWidth, imgHeight);
Â  Â  Â  Â  Â  Â  Â  Â  listStartY = imgY + imgHeight + 20;
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  const listHeight = GAME_HEIGHT - listStartY - 100;
Â  Â  Â  Â  Â  Â  const boxWidth = Math.min(GAME_WIDTH * 0.8, 350); const boxHeight = 40, gap = 10;
Â  Â  Â  Â  Â  Â  if (cachedLeaderboard === null) { ctx.font = '20px "MyGameFont"'; ctx.fillText('ë¡œë”© ì¤‘...', GAME_WIDTH / 2, listStartY + 50); }
Â  Â  Â  Â  Â  Â  else if (cachedLeaderboard.length === 0) { ctx.font = '20px "MyGameFont"'; ctx.fillText('ì•„ì§ ê¸°ë¡ì´ ì—†ìŠµë‹ˆë‹¤!', GAME_WIDTH / 2, listStartY + 50); }
Â  Â  Â  Â  Â  Â  else {Â 
Â  Â  Â  Â  Â  Â  Â  Â  const leaderboardItemsHeight = cachedLeaderboard.length * (boxHeight + gap) - gap;
Â  Â  Â  Â  Â  Â  Â  Â  const scrollableAreaHeight = listHeight;
Â  Â  Â  Â  Â  Â  Â  Â  const maxScroll = 0;Â 
Â  Â  Â  Â  Â  Â  Â  Â  const minScroll = -Math.max(0, leaderboardItemsHeight - scrollableAreaHeight);
Â  Â  Â  Â  Â  Â  Â  Â  if (leaderboardScrollY > maxScroll) leaderboardScrollY = maxScroll;Â 
Â  Â  Â  Â  Â  Â  Â  Â  if (leaderboardScrollY < minScroll) leaderboardScrollY = minScroll;
Â  Â  Â  Â  Â  Â  Â  Â  ctx.save();Â 
Â  Â  Â  Â  Â  Â  Â  Â  ctx.beginPath();Â 
Â  Â  Â  Â  Â  Â  Â  Â  ctx.rect(0, listStartY, GAME_WIDTH, scrollableAreaHeight);
Â  Â  Â  Â  Â  Â  Â  Â  ctx.clip();
Â  Â  Â  Â  Â  Â  Â  Â  cachedLeaderboard.forEach((entry, index) => {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const boxY = listStartY + index * (boxHeight + gap) + leaderboardScrollY;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const boxImg = index < 3 ? yellowImg : grayImg;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if (boxImg.complete) { ctx.drawImage(boxImg, (GAME_WIDTH - boxWidth) / 2, boxY, boxWidth, boxHeight); }
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  ctx.fillStyle = '#2c3e50'; ctx.font = 'bold 18px "MyGameFont"'; const rankTextX = (GAME_WIDTH - boxWidth) / 2 + 20;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const character = characters.find(c => c.name === entry.character);
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if (character && character.imgIcon) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const iconSize = 24; const iconX = rankTextX + 35;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  ctx.drawImage(character.imgIcon, iconX, boxY + (boxHeight - iconSize) / 2, iconSize, iconSize);
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  ctx.textAlign = 'left';
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  ctx.fillText(entry.name, iconX + iconSize + 10, boxY + 25);
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  } else { ctx.textAlign = 'left'; ctx.fillText(entry.name, rankTextX + 35, boxY + 25); }
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  ctx.fillText(`${index + 1}.`, rankTextX, boxY + 25);
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  ctx.textAlign = 'right';
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  ctx.fillText(entry.score, (GAME_WIDTH + boxWidth) / 2 - 20, boxY + 25);
Â  Â  Â  Â  Â  Â  Â  Â  });
Â  Â  Â  Â  Â  Â  Â  Â  ctx.restore();
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  drawConfirmButton(GAME_HEIGHT * 0.9);
Â  Â  Â  Â  }
Â  Â  Â  Â  function drawCharacterSelectScreen() {
Â  Â  Â  Â  Â  Â  ctx.fillStyle = '#2c3e50'; ctx.font = 'bold 32px "MyGameFont"'; ctx.textAlign = 'center'; ctx.fillText('ìºë¦­í„°ë¥¼ ì„ íƒí•˜ì„¸ìš”', GAME_WIDTH / 2, GAME_HEIGHT * 0.15);
Â  Â  Â  Â  Â  Â  const displayCharSize = Math.min(GAME_WIDTH / 4, 100); const gap = 20;
Â  Â  Â  Â  Â  Â  const totalWidth = (displayCharSize * characters.length) + (gap * (characters.length - 1));
Â  Â  Â  Â  Â  Â  let startX = (GAME_WIDTH - totalWidth) / 2;
Â  Â  Â  Â  Â  Â  const boxY = (GAME_HEIGHT - displayCharSize) / 2 - 50;
Â  Â  Â  Â  Â  Â  uiBoxes.characterBoxes = [];
Â  Â  Â  Â  Â  Â  characters.forEach(char => {
Â  Â  Â  Â  Â  Â  Â  Â  const isSelected = char.id === selectedCharacterId;
Â  Â  Â  Â  Â  Â  Â  Â  const scale = isSelected ? 1.2 : 1.0;
Â  Â  Â  Â  Â  Â  Â  Â  const currentSize = displayCharSize * scale;
Â  Â  Â  Â  Â  Â  Â  Â  const currentX = startX - (currentSize - displayCharSize) / 2;
Â  Â  Â  Â  Â  Â  Â  Â  const currentY = boxY - (currentSize - displayCharSize) / 2;
Â  Â  Â  Â  Â  Â  Â  Â  let imgToDraw = isSelected ? char.imgSelected : char.img;
Â  Â  Â  Â  Â  Â  Â  Â  let imgDrawWidth = currentSize; let imgDrawHeight = currentSize;
Â  Â  Â  Â  Â  Â  Â  Â  if (char.originalWidth && char.originalHeight) { const aspectRatio = char.originalWidth / char.originalHeight; if (aspectRatio > 1) { imgDrawHeight = currentSize / aspectRatio; } else { imgDrawWidth = currentSize * aspectRatio; } }
Â  Â  Â  Â  Â  Â  Â  Â  const imgDrawX = currentX + (currentSize - imgDrawWidth) / 2; const imgDrawY = currentY + (currentSize - imgDrawHeight) / 2;
Â  Â  Â  Â  Â  Â  Â  Â  if (imgToDraw) { ctx.drawImage(imgToDraw, imgDrawX, imgDrawY, imgDrawWidth, imgDrawHeight); }
Â  Â  Â  Â  Â  Â  Â  Â  ctx.fillStyle = '#2c3e50'; ctx.font = '20px "MyGameFont"'; ctx.fillText(char.name, startX + displayCharSize / 2, boxY + displayCharSize + 30);
Â  Â  Â  Â  Â  Â  Â  Â  uiBoxes.characterBoxes.push({ id: char.id, x: startX, y: boxY, width: displayCharSize, height: displayCharSize });
Â  Â  Â  Â  Â  Â  Â  Â  startX += displayCharSize + gap;
Â  Â  Â  Â  Â  Â  });
Â  Â  Â  Â  Â  Â  drawConfirmButton(GAME_HEIGHT * 0.8);
Â  Â  Â  Â  }
Â  Â  Â  Â  function drawMainMenu() {
Â  Â  Â  Â  Â  Â  let currentY = GAME_HEIGHT * 0.1;
Â  Â  Â  Â  Â  Â  if (cloverTitleImg.complete && cloverTitleImg.naturalWidth > 0) {
Â  Â  Â  Â  Â  Â  Â  Â  const imgWidth = GAME_WIDTH * 0.7;Â 
Â  Â  Â  Â  Â  Â  Â  Â  const imgHeight = (cloverTitleImg.naturalHeight / cloverTitleImg.naturalWidth) * imgWidth;
Â  Â  Â  Â  Â  Â  Â  Â  const imgX = (GAME_WIDTH - imgWidth) / 2;
Â  Â  Â  Â  Â  Â  Â  Â  ctx.drawImage(cloverTitleImg, imgX, currentY, imgWidth, imgHeight);
Â  Â  Â  Â  Â  Â  Â  Â  currentY += imgHeight + 20;
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  ctx.fillStyle = '#2c3e50'; ctx.font = '18px "MyGameFont"'; ctx.textAlign = 'center';
Â  Â  Â  Â  Â  Â  const lineHeight = 28; const iconSize = 20;
Â  Â  Â  Â  Â  Â  currentY += 20;
Â  Â  Â  Â  Â  Â  ctx.fillText('<ê²Œì„ë°©ë²•>', GAME_WIDTH / 2, currentY);
Â  Â  Â  Â  Â  Â  currentY += lineHeight * 1.5;
Â  Â  Â  Â  Â  Â  function drawLineWithIconAndColor(text, icon, y, textColor = '#2c3e50') { const textWidth = ctx.measureText(text).width; const totalWidth = iconSize + 5 + textWidth; const startX = (GAME_WIDTH - totalWidth) / 2; if (icon && icon.complete) { ctx.drawImage(icon, startX, y - iconSize, iconSize, iconSize); } ctx.textAlign = 'left'; ctx.fillStyle = textColor; ctx.fillText(text, startX + iconSize + 5, y); ctx.fillStyle = '#2c3e50'; }
Â  Â  Â  Â  Â  Â  ctx.textAlign = 'left';
Â  Â  Â  Â  Â  Â  drawLineWithIconAndColor('ë¥¼ ë§ì´ ë°›ì•„ ì ìˆ˜ë¥¼ ë‚´ëŠ” ê²Œì„ì…ë‹ˆë‹¤!', cloverImg, currentY);
Â  Â  Â  Â  Â  Â  currentY += lineHeight;
Â  Â  Â  Â  Â  Â  const line2_part1 = 'ë¥¼ 10ë²ˆ ë°›ì•„ '; const line2_part2 = 'LOVE'; const line2_part3 = ' ê²Œì´ì§€ê°€ ê°€ë“ ì°¨ë©´';
Â  Â  Â  Â  Â  Â  const line2_part1Width = ctx.measureText(line2_part1).width; const line2_part2Width = ctx.measureText(line2_part2).width;
Â  Â  Â  Â  Â  Â  const line2TotalWidth = iconSize + 5 + line2_part1Width + line2_part2Width + ctx.measureText(line2_part3).width;
Â  Â  Â  Â  Â  Â  const line2StartX = (GAME_WIDTH - line2TotalWidth) / 2;
Â  Â  Â  Â  Â  Â  if (loveImg.complete) ctx.drawImage(loveImg, line2StartX, currentY - iconSize, iconSize, iconSize);
Â  Â  Â  Â  Â  Â  ctx.textAlign = 'left'; ctx.fillStyle = '#2c3e50';
Â  Â  Â  Â  Â  Â  ctx.fillText(line2_part1, line2StartX + iconSize + 5, currentY);
Â  Â  Â  Â  Â  Â  ctx.fillStyle = '#ff69b4';
Â  Â  Â  Â  Â  Â  ctx.fillText(line2_part2, line2StartX + iconSize + 5 + line2_part1Width, currentY);
Â  Â  Â  Â  Â  Â  ctx.fillStyle = '#2c3e50';
Â  Â  Â  Â  Â  Â  ctx.fillText(line2_part3, line2StartX + iconSize + 5 + line2_part1Width + line2_part2Width, currentY);
Â  Â  Â  Â  Â  Â  currentY += lineHeight;
Â  Â  Â  Â  Â  Â  const text1 = "CLOVER TIME"; const text2 = "ì´ ë°œë™í•©ë‹ˆë‹¤";
Â  Â  Â  Â  Â  Â  const text1Width = ctx.measureText(text1).width; const totalTextWidth = text1Width + ctx.measureText(text2).width;
Â  Â  Â  Â  Â  Â  let textStartX = (GAME_WIDTH - totalTextWidth) / 2;
Â  Â  Â  Â  Â  Â  ctx.textAlign = 'left'; ctx.fillStyle = '#27ae60';
Â  Â  Â  Â  Â  Â  ctx.fillText(text1, textStartX, currentY);
Â  Â  Â  Â  Â  Â  ctx.fillStyle = '#2c3e50'; ctx.fillText(text2, textStartX + text1Width, currentY);
Â  Â  Â  Â  Â  Â  currentY += lineHeight;
Â  Â  Â  Â  Â  Â  const line4_part1 = 'ë¥¼ ì„¸ ë²ˆ ë°›ìœ¼ë©´ '; const line4_part2 = 'GAME OVER!';
Â  Â  Â  Â  Â  Â  const line4_part1Width = ctx.measureText(line4_part1).width; const line4TotalWidth = iconSize + 5 + line4_part1Width + ctx.measureText(line4_part2).width;
Â  Â  Â  Â  Â  Â  const line4StartX = (GAME_WIDTH - line4TotalWidth) / 2;
Â  Â  Â  Â  Â  Â  if (bombImg.complete) ctx.drawImage(bombImg, line4StartX, currentY - iconSize, iconSize, iconSize);
Â  Â  Â  Â  Â  Â  ctx.textAlign = 'left'; ctx.fillStyle = '#2c3e50';
Â  Â  Â  Â  Â  Â  ctx.fillText(line4_part1, line4StartX + iconSize + 5, currentY);
Â  Â  Â  Â  Â  Â  ctx.fillStyle = 'red'; ctx.fillText(line4_part2, line4StartX + iconSize + 5 + line4_part1Width, currentY);
Â  Â  Â  Â  Â  Â  ctx.fillStyle = '#2c3e50';
Â  Â  Â  Â  Â  Â  currentY += lineHeight;
Â  Â  Â  Â  Â  Â  ctx.textAlign = 'center';
Â  Â  Â  Â  Â  Â  const line5_part1 = "ì ìˆ˜ê°€ TOP 10 ì•ˆì— ë“ ë‹¤ë©´ "; const line5_part2 = "ëª…ì˜ˆì˜ ì „ë‹¹"; const line5_part3 = "ì— ì´ë¦„ì„ ì˜¬ë¦´ ìˆ˜ ìˆìŠµë‹ˆë‹¤";
Â  Â  Â  Â  Â  Â  const line5_part1Width = ctx.measureText(line5_part1).width; const line5_part2Width = ctx.measureText(line5_part2).width;
Â  Â  Â  Â  Â  Â  const line5TotalWidth = line5_part1Width + line5_part2Width + ctx.measureText(line5_part3).width;
Â  Â  Â  Â  Â  Â  const line5StartX = (GAME_WIDTH - line5TotalWidth) / 2;
Â  Â  Â  Â  Â  Â  ctx.textAlign = 'left'; ctx.fillText(line5_part1, line5StartX, currentY);
Â  Â  Â  Â  Â  Â  ctx.fillStyle = '#e67e22'; ctx.fillText(line5_part2, line5StartX + line5_part1Width, currentY);
Â  Â  Â  Â  Â  Â  ctx.fillStyle = '#2c3e50'; ctx.fillText(line5_part3, line5StartX + line5_part1Width + line5_part2Width, currentY);
Â  Â  Â  Â  Â  Â  currentY += lineHeight;
Â  Â  Â  Â  Â  Â  ctx.textAlign = 'center';
Â  Â  Â  Â  Â  Â  ctx.fillText('ì¬ë¯¸ìˆê²Œ ì¦ê²¨ì£¼ì„¸ìš”!â¤ï¸', GAME_WIDTH / 2, currentY);
Â  Â  Â  Â  Â  Â  currentY += 40;
Â  Â  Â  Â  Â  Â  const btnWidth = Math.min(GAME_WIDTH * 0.7, 300); const btnHeight = Math.min(GAME_HEIGHT * 0.08, 60);
Â  Â  Â  Â  Â  Â  const gap = btnHeight * 0.5;
Â  Â  Â  Â  Â  Â  const btnX = (GAME_WIDTH - btnWidth) / 2;
Â  Â  Â  Â  Â  Â  const btnFontSize = Math.min(btnHeight * 0.4, 24); ctx.font = `bold ${btnFontSize}px "MyGameFont"`;
Â  Â  Â  Â  Â  Â  let buttonStartY = currentY;
Â  Â  Â  Â  Â  Â  uiBoxes.charSelectBtn = { x: btnX, y: buttonStartY, width: btnWidth, height: btnHeight };
Â  Â  Â  Â  Â  Â  if (darkGrayBtnImg.complete) ctx.drawImage(darkGrayBtnImg, btnX, buttonStartY, btnWidth, btnHeight);
Â  Â  Â  Â  Â  Â  ctx.fillStyle = 'white'; ctx.textAlign = 'center'; ctx.fillText('ìºë¦­í„° ì„ íƒ', GAME_WIDTH / 2, buttonStartY + btnHeight / 2 + (btnFontSize / 3));
Â  Â  Â  Â  Â  Â  uiBoxes.leaderboardBtn = { x: btnX, y: buttonStartY + btnHeight + gap, width: btnWidth, height: btnHeight };
Â  Â  Â  Â  Â  Â  if (lightGrayBtnImg.complete) ctx.drawImage(lightGrayBtnImg, btnX, buttonStartY + btnHeight + gap, btnWidth, btnHeight);
Â  Â  Â  Â  Â  Â  ctx.fillStyle = 'black'; ctx.textAlign = 'center'; ctx.fillText('ëª…ì˜ˆì˜ ì „ë‹¹', GAME_WIDTH / 2, buttonStartY + btnHeight + gap + btnHeight / 2 + (btnFontSize / 3));
Â  Â  Â  Â  Â  Â  uiBoxes.startBtn = { x: btnX, y: buttonStartY + (btnHeight + gap) * 2, width: btnWidth, height: btnHeight };
Â  Â  Â  Â  Â  Â  if (darkGrayBtnImg.complete) ctx.drawImage(darkGrayBtnImg, btnX, buttonStartY + (btnHeight + gap) * 2, btnWidth, btnHeight);
Â  Â  Â  Â  Â  Â  ctx.fillStyle = 'white'; ctx.textAlign = 'center'; ctx.fillText('ê²Œì„ ì‹œì‘', GAME_WIDTH / 2, buttonStartY + (btnHeight + gap) * 2 + btnHeight / 2 + (btnFontSize / 3));
Â  Â  Â  Â  }
Â  Â  Â  Â  function drawStartScreen() { uiBoxes = {}; ctx.fillStyle = '#f0f0f0'; ctx.fillRect(0, 0, GAME_WIDTH, GAME_HEIGHT); if (startScreenState === 'main') { drawMainMenu(); } else if (startScreenState === 'leaderboard') { drawLeaderboardScreen(); } else if (startScreenState === 'characterSelect') { drawCharacterSelectScreen(); } }
Â  Â  Â  Â  function drawPauseScreen() {
Â  Â  Â  Â  Â  Â  drawObjects(); drawPlayer(); drawUI(false);
Â  Â  Â  Â  Â  Â  ctx.fillStyle = 'rgba(0, 0, 0, 0.5)';
Â  Â  Â  Â  Â  Â  ctx.fillRect(0, 0, GAME_WIDTH, GAME_HEIGHT);
Â  Â  Â  Â  Â  Â  const btnWidth = 200, btnHeight = 60, gap = 30;
Â  Â  Â  Â  Â  Â  const centerX = GAME_WIDTH / 2; const centerY = GAME_HEIGHT / 2;
Â  Â  Â  Â  Â  Â  uiBoxes.resumeBtn = { x: centerX - btnWidth / 2, y: centerY - btnHeight - gap / 2, width: btnWidth, height: btnHeight };
Â  Â  Â  Â  Â  Â  if(lightGrayBtnImg.complete) ctx.drawImage(lightGrayBtnImg, uiBoxes.resumeBtn.x, uiBoxes.resumeBtn.y, uiBoxes.resumeBtn.width, uiBoxes.resumeBtn.height);
Â  Â  Â  Â  Â  Â  ctx.fillStyle = 'black'; ctx.font = 'bold 24px "MyGameFont"'; ctx.textAlign = 'center';
Â  Â  Â  Â  Â  Â  ctx.fillText('ê³„ì†í•˜ê¸°', centerX, centerY - btnHeight / 2 - gap / 2 + 8);
Â  Â  Â  Â  Â  Â  uiBoxes.toMainBtn = { x: centerX - btnWidth / 2, y: centerY + gap / 2, width: btnWidth, height: btnHeight };
Â  Â  Â  Â  Â  Â  if(darkGrayBtnImg.complete) ctx.drawImage(darkGrayBtnImg, uiBoxes.toMainBtn.x, uiBoxes.toMainBtn.y, uiBoxes.toMainBtn.width, uiBoxes.toMainBtn.height);
Â  Â  Â  Â  Â  Â  ctx.fillStyle = 'white';
Â  Â  Â  Â  Â  Â  ctx.fillText('ë©”ì¸ìœ¼ë¡œ', centerX, centerY + btnHeight / 2 + gap / 2 + 8);
Â  Â  Â  Â  }
Â  Â  Â  Â  function drawGameOver() { ctx.fillStyle = 'rgba(0, 0, 0, 0.7)'; ctx.fillRect(0, 0, GAME_WIDTH, GAME_HEIGHT); ctx.fillStyle = 'white'; ctx.font = 'bold 40px "MyGameFont"'; ctx.textAlign = 'center'; ctx.fillText('GAME OVER', GAME_WIDTH / 2, GAME_HEIGHT / 2 - 40); ctx.font = '24px "MyGameFont"'; ctx.fillText(`Final Score: ${score}`, GAME_WIDTH / 2, GAME_HEIGHT / 2); ctx.font = '20px "MyGameFont"'; ctx.fillText('Tap to Save Score', GAME_WIDTH / 2, GAME_HEIGHT / 2 + 40); }
Â  Â  Â  Â  function drawUI(drawButton = true) {
Â  Â  Â  Â  Â  Â  ctx.fillStyle = 'black'; ctx.font = '24px "MyGameFont"'; ctx.textAlign = 'left';
Â  Â  Â  Â  Â  Â  ctx.fillText(`Score: ${score}`, 15, 30);
Â  Â  Â  Â  Â  Â  const gaugeWidth = 150, gaugeHeight = 20, gaugeX = 15, gaugeY = 45;
Â  Â  Â  Â  Â  Â  ctx.strokeStyle = '#333'; ctx.strokeRect(gaugeX, gaugeY, gaugeWidth, gaugeHeight);
Â  Â  Â  Â  Â  Â  const fillWidth = (gaugeWidth * feverScore) / FEVER_TRIGGER_COUNT;
Â  Â  Â  Â  Â  Â  ctx.fillStyle = '#ff69b4';
Â  Â  Â  Â  Â  Â  ctx.fillRect(gaugeX, gaugeY, fillWidth, gaugeHeight);
Â  Â  Â  Â  Â  Â  ctx.fillStyle = '#ff69b4';
Â  Â  Â  Â  Â  Â  ctx.font = '16px "MyGameFont"';
Â  Â  Â  Â  Â  Â  ctx.fillText('LOVE', gaugeX + gaugeWidth + 10, gaugeY + 16);
Â  Â  Â  Â  Â  Â  ctx.textAlign = 'left';
Â  Â  Â  Â  Â  Â  let hearts = '';
Â  Â  Â  Â  Â  Â  for (let i = 0; i < MAX_LIVES; i++) { hearts += (i < lives) ? 'â¤ï¸' : 'ğŸ–¤'; }
Â  Â  Â  Â  Â  Â  ctx.font = '24px Arial';
Â  Â  Â  Â  Â  Â  ctx.fillText(hearts, 15, gaugeY + gaugeHeight + 25);
Â  Â  Â  Â  Â  Â  if (isFeverTime) { ctx.fillStyle = 'orange'; ctx.font = 'bold 36px "MyGameFont"'; ctx.textAlign = 'center'; ctx.fillText(`CLOVER TIME!`, GAME_WIDTH / 2, 120); ctx.fillText(`${(feverTimer / 1000).toFixed(1)}s`, GAME_WIDTH / 2, 160); }
Â  Â  Â  Â  Â  Â  if (drawButton) { const btnSize = 40, margin = 15; const btnX = GAME_WIDTH - btnSize - margin; const btnY = margin; pauseButtonBox = { x: btnX, y: btnY, width: btnSize, height: btnSize }; ctx.fillStyle = 'rgba(0, 0, 0, 0.5)'; ctx.fillRect(btnX, btnY, btnSize, btnSize); ctx.fillStyle = 'white'; ctx.fillRect(btnX + 10, btnY + 10, 7, 20); ctx.fillRect(btnX + 23, btnY + 10, 7, 20); }
Â  Â  Â  Â  }

Â  Â  Â  Â  function movePlayer() { if (player.dx !== 0) { player.x += player.dx; targetX = player.x; } else { player.x += (targetX - player.x) * 0.5; } if (player.x < 0) player.x = 0; if (player.x + player.width > GAME_WIDTH) player.x = GAME_WIDTH - player.width; }
Â  Â  Â  Â Â 
Â  Â  Â  Â  function updateObjects(deltaTime) {
Â  Â  Â  Â  Â  Â  spawnTimer += deltaTime;Â 
Â  Â  Â  Â  Â  Â  gameSpeedMultiplier = 1 + (score * 0.01);
Â  Â  Â  Â  Â  Â  if (player.hitTimer > 0) { player.hitTimer -= deltaTime; }
Â  Â  Â  Â  Â  Â  if (isFeverTime) {
Â  Â  Â  Â  Â  Â  Â  Â  feverTimer -= deltaTime; if (feverTimer <= 0) isFeverTime = false;
Â  Â  Â  Â  Â  Â  Â  Â  if (spawnTimer > FEVER_SPAWN_INTERVAL / gameSpeedMultiplier) { objects.push({ x: Math.random() * (GAME_WIDTH - 40), y: -40, width: 40, height: 40, speed: 200, type: 'good' }); spawnTimer = 0; }
Â  Â  Â  Â  Â  Â  } else {
Â  Â  Â  Â  Â  Â  Â  Â  if (spawnTimer > BASE_SPAWN_INTERVAL / gameSpeedMultiplier) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  let type = 'good';
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const rand = Math.random();
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if (rand < 0.3) { type = 'bad'; }
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  else if (rand < 0.45) { type = 'special'; }
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  objects.push({ x: Math.random() * (GAME_WIDTH - 40), y: -40, width: 40, height: 40, speed: (1.5 + Math.random() * 2) * 100, type: type });
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  spawnTimer = 0;
Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  for (let i = objects.length - 1; i >= 0; i--) {
Â  Â  Â  Â  Â  Â  Â  Â  const obj = objects[i]; obj.y += obj.speed * gameSpeedMultiplier * (deltaTime / 1000);
Â  Â  Â  Â  Â  Â  Â  Â  if (obj.y > GAME_HEIGHT) { objects.splice(i, 1); continue; }
Â  Â  Â  Â  Â  Â  Â  Â  if (player.x < obj.x + obj.width && player.x + player.width > obj.x && player.y < obj.y + obj.height && player.y + player.height > obj.y) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if (obj.type === 'bad') {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  lives--;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  objects.splice(i, 1);
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  player.hitTimer = 500;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const selectedChar = characters.find(c => c.id === selectedCharacterId);
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if (selectedChar) playSound(selectedChar.hitSfxSrc, selectedChar.hitVolume);
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  playSound(BOMB_HIT_SFX_SRC, 1.0);
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if (lives <= 0) { gameState = 'gameOver'; bgm.pause(); playSound(GAME_OVER_SFX_SRC); }
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  } else if (obj.type === 'special') { feverScore++; objects.splice(i, 1); if (feverScore >= FEVER_TRIGGER_COUNT) { isFeverTime = true; feverTimer = FEVER_DURATION; feverScore = 0; } }
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  else { score++; objects.splice(i, 1); }
Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  }

Â  Â  Â  Â  async function handleInteractionStart(e) {
Â  Â  Â  Â  Â  Â  e.preventDefault(); const pos = getEventPos(e);
Â  Â  Â  Â  Â  Â  if (!hasInteracted) {
Â  Â  Â  Â  Â  Â  Â  Â  hasInteracted = true;
Â  Â  Â  Â  Â  Â  Â  Â  bgm.volume = BGM_VOLUME_MENU;
Â  Â  Â  Â  Â  Â  Â  Â  bgm.loop = true;
Â  Â  Â  Â  Â  Â  Â  Â  bgm.play().catch(()=>{});
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  if (gameState === 'startScreen') {
Â  Â  Â  Â  Â  Â  Â  Â  if (startScreenState === 'main') {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if (isInside(pos, uiBoxes.charSelectBtn)) { playSound(BUTTON_CLICK_SFX_SRC); startScreenState = 'characterSelect'; }
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  else if (isInside(pos, uiBoxes.leaderboardBtn)) { playSound(BUTTON_CLICK_SFX_SRC); leaderboardScrollY = 0; startScreenState = 'leaderboard'; }
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  else if (isInside(pos, uiBoxes.startBtn)) { playSound(BUTTON_CLICK_SFX_SRC); init(); }
Â  Â  Â  Â  Â  Â  Â  Â  } else {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if (startScreenState === 'characterSelect') {Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  uiBoxes.characterBoxes.forEach(box => {Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if (isInside(pos, box) && selectedCharacterId !== box.id) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  selectedCharacterId = box.id;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const selectedChar = characters.find(c => c.id === selectedCharacterId);
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if (selectedChar) playSound(selectedChar.selectSfxSrc, selectedChar.selectVolume);
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  });Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if (isInside(pos, uiBoxes.confirmBtn)) { playSound(BUTTON_CLICK_SFX_SRC); startScreenState = 'main'; leaderboardScrollY = 0; }
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if (startScreenState === 'leaderboard') { isDragging = true; lastTouchY = pos.y; if (isInside(pos, uiBoxes.confirmBtn)) { playSound(BUTTON_CLICK_SFX_SRC); startScreenState = 'main'; leaderboardScrollY = 0; } }
Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  } else if (gameState === 'playing') {
Â  Â  Â  Â  Â  Â  Â  Â  if (isInside(pos, pauseButtonBox)) { playSound(BUTTON_CLICK_SFX_SRC); gameState = 'paused'; bgm.pause(); }
Â  Â  Â  Â  Â  Â  Â  Â  else { player.dx = 0; targetX = pos.x - player.width / 2; }
Â  Â  Â  Â  Â  Â  } else if (gameState === 'paused') {
Â  Â  Â  Â  Â  Â  Â  Â  if (isInside(pos, uiBoxes.resumeBtn)) { playSound(BUTTON_CLICK_SFX_SRC); gameState = 'playing'; bgm.volume = BGM_VOLUME_NORMAL; bgm.play(); }
Â  Â  Â  Â  Â  Â  Â  Â  else if (isInside(pos, uiBoxes.toMainBtn)) { playSound(BUTTON_CLICK_SFX_SRC); gameState = 'startScreen'; startScreenState = 'main'; bgm.volume = BGM_VOLUME_MENU; }
Â  Â  Â  Â  Â  Â  } else if (gameState === 'gameOver') {
Â  Â  Â  Â  Â  Â  Â  Â  const nickname = prompt(`ê²Œì„ ì˜¤ë²„!\nìµœì¢… ì ìˆ˜: ${score}\n\nìˆœìœ„ì— ë“±ë¡í•  ë‹‰ë„¤ì„ì„ ì…ë ¥í•˜ì„¸ìš”:`, '');
Â  Â  Â  Â  Â  Â  Â  Â  if (nickname && nickname.trim() !== '') { await saveToLeaderboard(score, nickname.trim()); }
Â  Â  Â  Â  Â  Â  Â  Â  gameState = 'startScreen'; startScreenState = 'main'; lastTime = 0;
Â  Â  Â  Â  Â  Â  Â  Â  bgm.volume = BGM_VOLUME_MENU;
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  }
Â  Â  Â  Â Â 
Â  Â  Â  Â  function handleInteractionMove(e) { e.preventDefault(); const pos = getEventPos(e); if (gameState === 'startScreen' && startScreenState === 'leaderboard' && isDragging) { const deltaY = pos.y - lastTouchY; leaderboardScrollY += deltaY; lastTouchY = pos.y; } else if (gameState === 'playing' && (e.buttons === 1 || e.touches)) { player.dx = 0; targetX = pos.x - player.width / 2; } }
Â  Â  Â  Â  function handleInteractionEnd(e) { isDragging = false; }
Â  Â  Â  Â  function handleKeyDown(e) { if (gameState !== 'playing') return; if (e.key === 'ArrowRight' || e.key === 'Right') player.dx = player.speed; else if (e.key === 'ArrowLeft' || e.key === 'Left') player.dx = -player.speed; }
Â  Â  Â  Â  function handleKeyUp(e) { if (e.key === 'ArrowRight' || e.key === 'Right' || e.key === 'ArrowLeft' || e.key === 'Left') player.dx = 0; }
Â  Â  Â  Â  function handleWheel(e) { if (gameState === 'startScreen' && startScreenState === 'leaderboard') { e.preventDefault(); leaderboardScrollY -= e.deltaY * 0.5; } }
Â  Â  Â  Â Â 
Â  Â  Â  Â  function gameLoop(timestamp) {
Â  Â  Â  Â  Â  Â  cancelAnimationFrame(animationFrameId);
Â  Â  Â  Â  Â  Â  if (gameState === 'loading') { drawCurrentState(); animationFrameId = requestAnimationFrame(gameLoop); return; }
Â  Â  Â  Â  Â  Â  if (!lastTime) lastTime = timestamp;
Â  Â  Â  Â  Â  Â  const deltaTime = timestamp - lastTime;
Â  Â  Â  Â  Â  Â  lastTime = timestamp;
Â  Â  Â  Â  Â  Â  if (gameState === 'playing') { updateObjects(deltaTime); movePlayer(); }
Â  Â  Â  Â  Â  Â  drawCurrentState();
Â  Â  Â  Â  Â  Â  animationFrameId = requestAnimationFrame(gameLoop);
Â  Â  Â  Â  }

Â  Â  Â  Â  // --- ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ë° ê²Œì„ ì‹œì‘ì  ---
Â  Â  Â  Â  window.addEventListener('resize', resizeCanvas);
Â  Â  Â  Â  document.addEventListener('visibilitychange', () => { if (document.hidden && gameState === 'playing') { gameState = 'paused'; bgm.pause(); } });
Â  Â  Â  Â  document.addEventListener('keydown', handleKeyDown);
Â  Â  Â  Â  document.addEventListener('keyup', handleKeyUp);
Â  Â  Â  Â  canvas.addEventListener('touchstart', handleInteractionStart, { passive: false });
Â  Â  Â  Â  canvas.addEventListener('touchmove', handleInteractionMove, { passive: false });
Â  Â  Â  Â  canvas.addEventListener('touchend', handleInteractionEnd);
Â  Â  Â  Â  canvas.addEventListener('mousedown', handleInteractionStart);
Â  Â  Â  Â  canvas.addEventListener('mousemove', handleInteractionMove);
Â  Â  Â  Â  canvas.addEventListener('mouseup', handleInteractionEnd);
Â  Â  Â  Â  canvas.addEventListener('wheel', handleWheel, { passive: false });

Â  Â  Â  Â  initializeFirebase();
Â  Â  Â  Â  bgm.volume = BGM_VOLUME_MENU;
Â  Â  Â  Â  resizeCanvas();
Â  Â  Â  Â  listenForLeaderboardUpdates();
Â  Â  Â  Â Â 
Â  Â  Â  Â  Promise.all([loadImages(), document.fonts.ready]).then(() => {
Â  Â  Â  Â  Â  Â  gameState = 'startScreen';
Â  Â  Â  Â  }).catch(error => {
Â  Â  Â  Â  Â  Â  console.error(error);
Â  Â  Â  Â  Â  Â  alert('ì½˜í…ì¸ ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ë° ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤. íŒŒì¼ ê²½ë¡œë¥¼ í™•ì¸í•´ì£¼ì„¸ìš”.');
Â  Â  Â  Â  });
Â  Â  Â  Â Â 
Â  Â  Â  Â  gameLoop(0);
Â  Â  </script>
</body>
</html>
