<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <title>Firebase 연결 최종 테스트</title>
    <style> body { font-family: sans-serif; padding: 20px; } </style>
</head>
<body>
    <h1>Firebase 연결 최종 테스트</h1>
    <p>페이지가 로드되면 아래에 테스트 결과가 표시됩니다.</p>
    <div id="results"></div>

    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-firestore-compat.js"></script>

    <script>
        const resultsDiv = document.getElementById('results');
        
        // --- 1. Firebase 라이브러리 로드 확인 ---
        if (typeof firebase !== 'undefined') {
            resultsDiv.innerHTML += '<p style="color: green;">✅ Step 1: Firebase 라이브러리 로드 성공!</p>';
        } else {
            resultsDiv.innerHTML += '<p style="color: red;">❌ Step 1: Firebase 라이브러리 로드 실패! 스크립트 태그를 확인하세요.</p>';
        }

        const firebaseConfig = {
            apiKey: "AIzaSyBDYkDY4UxRP2182lKvHbqE6kZ1uJcHspg",
            authDomain: "clover-game.firebaseapp.com",
            projectId: "clover-game",
            storageBucket: "clover-game.appspot.com",
            messagingSenderId: "596891629209",
            appId: "1:596891629209:web:27b9c386df467d845aaa08"
        };

        let db;
        try {
            firebase.initializeApp(firebaseConfig);
            db = firebase.firestore();
            resultsDiv.innerHTML += '<p style="color: green;">✅ Step 2: Firebase 초기화 성공! (firebaseConfig 키가 유효합니다)</p>';
        } catch (e) {
            resultsDiv.innerHTML += `<p style="color: red;">❌ Step 2: Firebase 초기화 실패! firebaseConfig를 다시 확인해주세요. 오류: ${e.message}</p>`;
        }

        async function testDatabaseConnection() {
            if (!db) {
                resultsDiv.innerHTML += '<p style="color: red;">❌ Step 3: 데이터베이스 연결 테스트 실패! (초기화 실패)</p>';
                return;
            }
            const testCollection = db.collection('test-connection');
            try {
                // 테스트 데이터 쓰기 시도
                await testCollection.doc('test-doc').set({ timestamp: new Date() });
                resultsDiv.innerHTML += '<p style="color: green;">✅ Step 3: Firestore 데이터베이스 쓰기 성공! (보안 규칙 정상)</p>';
                
                // 테스트 데이터 읽기 시도
                const doc = await testCollection.doc('test-doc').get();
                if (doc.exists) {
                    resultsDiv.innerHTML += '<p style="color: green;">✅ Step 4: Firestore 데이터베이스 읽기 성공! (보안 규칙 정상)</p>';
                    resultsDiv.innerHTML += '<h2>🎉 모든 연결이 정상입니다!</h2>';
                } else {
                     resultsDiv.innerHTML += '<p style="color: red;">❌ Step 4: Firestore 데이터베이스 읽기 실패!</p>';
                }
            } catch (e) {
                resultsDiv.innerHTML += `<p style="color: red;">❌ Step 3 또는 4: 데이터베이스 테스트 실패! 보안 규칙을 확인하세요. 오류: ${e.message}</p>`;
            }
        }
        
        // 페이지가 로드되면 바로 테스트 실행
        testDatabaseConnection();
    </script>
</body>
</html>
