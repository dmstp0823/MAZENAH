<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>물체 잡기 (최종)</title>
    <style>
        body { margin: 0; overflow: hidden; background-color: #f0f0f0; }
        canvas { display: block; }
    </style>
</head>
<body>
    <canvas id="gameCanvas"></canvas>

    <script>
        const canvas = document.getElementById('gameCanvas');
        const ctx = canvas.getContext('2d');

        // --- 게임 상태 및 변수 설정 ---
        let player, objects, score, gameState, spawnTimer;
        let targetX; // 플레이어가 이동할 목표 X좌표

        // --- 게임 초기화 및 재시작 함수 ---
        function init() {
            player = {
                width: 60, height: 20,
                x: canvas.width / 2 - 30,
                y: canvas.height - 60,
                speed: 8
            };
            
            targetX = player.x;
            objects = [];
            score = 0;
            spawnTimer = 0;
            gameState = 'playing'; // 게임 상태: playing, gameOver
        }

        // --- 화면 크기 조절 ---
        function resizeCanvas() {
            canvas.width = window.innerWidth;
            canvas.height = window.innerHeight;
            init(); // 화면 크기가 바뀌면 게임을 초기화
        }
        window.addEventListener('resize', resizeCanvas);

        // --- 터치 및 마우스 이벤트 처리 ---
        function getEventX(e) {
            return e.touches ? e.touches[0].clientX : e.clientX;
        }

        // 1. 화면 누르고 있을 때 이동
        function handleMoveStart(e) {
            e.preventDefault();
            if (gameState === 'playing') {
                targetX = getEventX(e) - player.width / 2;
            } else if (gameState === 'gameOver') {
                // 게임오버 화면에서 터치하면 재시작
                init();
            }
        }

        function handleMove(e) {
            e.preventDefault();
            if (gameState === 'playing' && (e.buttons === 1 || e.touches)) {
                targetX = getEventX(e) - player.width / 2;
            }
        }

        // 2. 화면에서 손을 떼면 정지
        function handleMoveEnd(e) {
            e.preventDefault();
            if (gameState === 'playing') {
                targetX = player.x; // 목표 지점을 현재 플레이어 위치로 설정해 멈추게 함
            }
        }

        canvas.addEventListener('touchstart', handleMoveStart);
        canvas.addEventListener('touchmove', handleMove);
        canvas.addEventListener('touchend', handleMoveEnd);
        canvas.addEventListener('mousedown', handleMoveStart);
        canvas.addEventListener('mousemove', handleMove);
        canvas.addEventListener('mouseup', handleMoveEnd);

        // --- 그리기 함수들 ---
        function drawPlayer() {
            ctx.fillStyle = 'blue';
            ctx.fillRect(player.x, player.y, player.width, player.height);
        }

        function drawObjects() {
            ctx.fillStyle = 'red';
            objects.forEach(obj => {
                ctx.fillRect(obj.x, obj.y, obj.width, obj.height);
            });
        }
        
        function drawScore() {
            ctx.fillStyle = 'black';
            ctx.font = '24px Arial';
            ctx.fillText(`Score: ${score}`, 15, 30);
        }

        function drawGameOver() {
            ctx.fillStyle = 'rgba(0, 0, 0, 0.7)';
            ctx.fillRect(0, 0, canvas.width, canvas.height);
            
            ctx.fillStyle = 'white';
            ctx.font = 'bold 40px Arial';
            ctx.textAlign = 'center';
            ctx.fillText('GAME OVER', canvas.width / 2, canvas.height / 2 - 40);
            
            ctx.font = '24px Arial';
            ctx.fillText(`Final Score: ${score}`, canvas.width / 2, canvas.height / 2);
            
            ctx.font = '20px Arial';
            ctx.fillText('Tap to Restart', canvas.width / 2, canvas.height / 2 + 40);
        }

        // --- 로직 함수들 ---
        function movePlayer() {
            const dx = targetX - player.x;
            if (Math.abs(dx) > 1) { // 약간의 오차 범위를 둬서 부드럽게 멈춤
                player.x += dx * 0.1; // 이전보다 더 부드럽게 이동
            }
            if (player.x < 0) player.x = 0;
            if (player.x + player.width > canvas.width) {
                player.x = canvas.width - player.width;
            }
        }
        
        // 3. 연속으로 물체 생성 및 이동
        function updateObjects() {
            // 일정 시간마다 새 물체 생성
            spawnTimer++;
            if (spawnTimer > 45) { // 45프레임(약 0.75초)마다 하나씩 생성
                objects.push({
                    x: Math.random() * (canvas.width - 25),
                    y: -25,
                    width: 25, height: 25,
                    speed
