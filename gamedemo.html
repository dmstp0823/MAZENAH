<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>물체 잡기 (시작 화면 추가)</title>
    <style>
        body { margin: 0; overflow: hidden; background-color: #f0f0f0; }
        canvas { display: block; }
    </style>
</head>
<body>
    <canvas id="gameCanvas"></canvas>

    <script>
        const canvas = document.getElementById('gameCanvas');
        const ctx = canvas.getContext('2d');

        // --- 게임 상태 및 변수 설정 ---
        let player, objects, score, spawnTimer;
        let targetX;
        let gameState = 'startScreen'; // 게임 상태: startScreen, playing, gameOver

        // --- 게임 초기화 및 재시작 함수 ---
        function init() {
            player = {
                width: 60, height: 20,
                x: canvas.width / 2 - 30,
                y: canvas.height - 60,
                speed: 8
            };
            
            targetX = player.x;
            objects = [];
            score = 0;
            spawnTimer = 0;
            gameState = 'playing'; // 게임을 'playing' 상태로 변경
        }

        // --- 화면 크기 조절 ---
        function resizeCanvas() {
            canvas.width = window.innerWidth;
            canvas.height = window.innerHeight;
        }
        window.addEventListener('resize', resizeCanvas);

        // --- 터치 및 마우스 이벤트 처리 ---
        function getEventX(e) {
            return e.touches ? e.touches[0].clientX : e.clientX;
        }

        function handleInteractionStart(e) {
            e.preventDefault();
            // 1. 시작 또는 게임오버 화면에서 터치하면 게임 시작/재시작
            if (gameState === 'startScreen' || gameState === 'gameOver') {
                init();
            } 
            // 2. 게임 중일 때 터치하면 플레이어 이동
            else if (gameState === 'playing') {
                targetX = getEventX(e) - player.width / 2;
            }
        }

        function handleInteractionMove(e) {
            e.preventDefault();
            if (gameState === 'playing' && (e.buttons === 1 || e.touches)) {
                targetX = getEventX(e) - player.width / 2;
            }
        }

        function handleInteractionEnd(e) {
            e.preventDefault();
            if (gameState === 'playing') {
                targetX = player.x;
            }
        }

        canvas.addEventListener('touchstart', handleInteractionStart);
        canvas.addEventListener('touchmove', handleInteractionMove);
        canvas.addEventListener('touchend', handleInteractionEnd);
        canvas.addEventListener('mousedown', handleInteractionStart);
        canvas.addEventListener('mousemove', handleInteractionMove);
        canvas.addEventListener('mouseup', handleInteractionEnd);

        // --- 그리기 함수들 ---
        // 3. 시작 화면 그리기 함수 추가
        function drawStartScreen() {
            ctx.fillStyle = '#3498db'; // 시작 화면 배경색
            ctx.fillRect(0, 0, canvas.width, canvas.height);
            
            ctx.fillStyle = 'white';
            ctx.font = 'bold 40px Arial';
            ctx.textAlign = 'center';
            ctx.fillText('물체 잡기 게임', canvas.width / 2, canvas.height / 2 - 40);
            
            ctx.font = '24px Arial';
            ctx.fillText('화면을 눌러 시작하세요', canvas.width / 2, canvas.height / 2 + 20);
        }

        function drawPlayer() { /* ... 이전과 동일 ... */ 
            ctx.fillStyle = 'blue';
            ctx.fillRect(player.x, player.y, player.width, player.height);
        }

        function drawObjects() { /* ... 이전과 동일 ... */ 
            ctx.fillStyle = 'red';
            objects.forEach(obj => {
                ctx.fillRect(obj.x, obj.y, obj.width, obj.height);
            });
        }
        
        function drawScore() { /* ... 이전과 동일 ... */ 
            ctx.fillStyle = 'black';
            ctx.font = '24px Arial';
            ctx.textAlign = 'left';
            ctx.fillText(`Score: ${score}`, 15, 30);
        }

        function drawGameOver() { /* ... 이전과 동일 ... */ 
            ctx.fillStyle = 'rgba(0, 0, 0, 0.7)';
            ctx.fillRect(0, 0, canvas.width, canvas.height);
            
            ctx.fillStyle = 'white';
            ctx.font = 'bold 40px Arial';
            ctx.textAlign = 'center';
            ctx.fillText('GAME OVER', canvas.width / 2, canvas.height / 2 - 40);
            
            ctx.font = '24px Arial';
            ctx.fillText(`Final Score: ${score}`, canvas.width / 2, canvas.height / 2);
            
            ctx.font = '20px Arial';
            ctx.fillText('Tap to Restart', canvas.width / 2, canvas.height / 2 + 40);
        }

        // --- 로직 함수들 (이전과 동일) ---
        function movePlayer() { /* ... 이전과 동일 ... */ 
            const dx = targetX - player.x;
            if (Math.abs(dx) > 1) {
                player.x += dx * 0.1;
            }
            if (player.x < 0) player.x = 0;
            if (player.x + player.width > canvas.width) {
                player.x = canvas.width - player.width;
            }
        }
        
        function updateObjects() { /* ... 이전과 동일 ... */ 
            spawnTimer++;
            if (spawnTimer > 45) {
                objects.push({
                    x: Math.random() * (canvas.width - 25),
                    y: -25,
                    width: 25, height: 25,
                    speed: 2 + Math.random() * 3
                });
                spawnTimer = 0;
            }

            for (let i = objects.length - 1; i >= 0; i--) {
                const obj = objects[i];
                obj.y += obj.speed;
                if (obj.y > canvas.height) {
                    gameState = 'gameOver';
                }
                if (
                    player.x < obj.x + obj.width &&
                    player.x + player.width > obj.x &&
                    player.y < obj.y + obj.height &&
                    player.y + player.height > obj.y
                ) {
                    score++;
                    objects.splice(i, 1);
                }
            }
        }
        
        // --- 메인 게임 루프 ---
        function update() {
            ctx.clearRect(0, 0, canvas.width, canvas.height);

            // 4. 게임 상태에 따라 다른 화면을 그림
            if (gameState === 'startScreen') {
                drawStartScreen();
            } else if (gameState === 'playing') {
                updateObjects();
                movePlayer();
                drawObjects();
                drawPlayer();
                drawScore();
            } else if (gameState === 'gameOver') {
                drawGameOver();
            }

            requestAnimationFrame(update);
        }

        // --- 게임 시작 ---
        resizeCanvas();
        update();
    </script>
</body>
</html>
